<div ng-app="OpenProjectLegacy" class="ng-scope">
    <div id="invisible-grid" class="widget-boxes project-overview">
        <div class="grid-block">
            <div style="flex: 0 0 23%; max-width: 23%;">
                <p style="text-align: center;font-weight: bold;margin: -2px;">Показатели</p>
                <homescreen-diagram chart-name='pokazateli' chart-labels='["Нет откл.","Небольшие откл.","Значит. откл", "Нет данных"]' chart-colors='["#00b050", "#ffc000", "#c00000", "#1f497d"]'>
                </homescreen-diagram>
            </div>
            <div style="flex: 0 0 23%; max-width: 23%;">
                <p style="text-align: center;font-weight: bold;margin: -2px;">КТ</p>
                <homescreen-diagram chart-name='kt' chart-labels='["Исп.","Не исп.","В работе","Риски"]' chart-colors='["#00b050", "#c00000", "#1f497d", "#ffc000"]'>
                </homescreen-diagram>
            </div>
            <div style="flex: 0 0 23%; max-width: 23%;">
                <p style="text-align: center;font-weight: bold;margin: -2px;">Бюджет</p>
                <homescreen-diagram chart-name='budget' chart-labels='["Исп.","Не исп.","Остаток"]' chart-colors='["#00b050", "#c00000", "#1f497d"]'>
                </homescreen-diagram>
            </div>
            <div style="flex: 0 0 23%; max-width: 23%;">
                <p style="text-align: center;font-weight: bold;margin: -2px;">Риски</p>
                <!--
                <homescreen-diagram chart-name='riski' chart-labels='["Отсутств.", "Незначит.","Критич."]' chart-colors='["#00b050", "#ffc000", "#c00000"]'>
                -->
                <homescreen-diagram chart-name='riski' chart-labels='["Незначит.","Критич."]'
                                    chart-colors='["#ffc000", "#c00000"]'>
                </homescreen-diagram>
            </div>
            <div style="text-align: center; width: 8%; background-color: #c0504d; margin-right: 10px;" >
                <a style="font-weight: bold; color: white; position:relative; top:40%" class="problems-a" href="{{this.getBasePath()}}/vkladka1/problems">Проблем<br>{{problemCount}}</a>
            </div>
        </div>
    </div>
<!--    <div class="grid-block" style="border: 2px solid #1C6EA4;border-radius: 5px;display: inline-flex;margin: 10px 0px">-->

<!--        <button style="border: none;background: #1C6EA4;" class="icon-search"></button>-->
<!--    </div>-->
    <div class="ng-autocomplete" style="width: 100%;border: 2px solid #1C6EA4;display: inline-flex;margin: 10px 0;">
        <ng-autocomplete [data]="data_autocomplete"
                         [searchKeyword]="keyword"
                         [isLoading]="is_loading"
                         placeHolder="Все проекты..."
                         (selected)="selectEvent($event)"
                         (inputCleared)="selectEvent({id: 0, name: 'Все проекты'})"
                         [itemTemplate]="itemTemplate"
                         [notFoundTemplate]="notFoundTemplate"
                         debounceTime="1000"
                         notFoundText="Не найдено">
        </ng-autocomplete>
        <button class="icon-search" style="color: white;width: 8%;background: #1C6EA4;border: 1px #1C6EA4"></button>
        <ng-template #itemTemplate let-item >
            <a [innerHTML]="item.name" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; padding: 5px 5px;"></a>
        </ng-template>
        <ng-template #notFoundTemplate let-notFound>
            <div [innerHTML]="notFound"></div>
        </ng-template>
    </div>
    <select [(ngModel)]="selectedOption"
            [compareWith]="compareByHref"
            (change)="handleUserSubmit()"
            style="width: 200px" [hidden]="true">
        <option
                *ngFor="let value of valueOptions"
                [attr.selected]="compareByHref(selectedOption, value) || undefined"
                [attr.label]="value.name"
                [ngValue]="value"
                [textContent]="value.name">
        </option>
    </select>
    <homescreen-blue-table [template]="'desktop'"></homescreen-blue-table>
    <div style="display: inline-flex;border: 1px solid #1A67A3;width: 100%;">
        <table border="0" class="coloredTable">
            <thead>
            <tr>
                <th class="colored-col-green" colspan="3">Предстоящие мероприятия:</th>
                <th class="colored-col-red" colspan="3">Просроченные КТ:</th>
                <th class="colored-col-orange" colspan="3">Проблемы:</th>
                <th class="colored-col-purple" colspan="3">Бюджет:</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of data; let i = index" >
                <td *ngIf="item.upcoming_tasks"
                    [ngClass]="getGreenClass(i)"
                    [textContent]="i + 1"></td>
                <td *ngIf="item.upcoming_tasks"
                    [ngClass]="getGreenClass(i)">
                    <a href="{{this.getBasePath()}}/projects/{{item.upcoming_tasks.projectId}}/work_packages/{{item.upcoming_tasks.id}}/activity?plan_type=execution"
                       [textContent]="shorten(item.upcoming_tasks.subject)" [title]="item.upcoming_tasks.subject"></a>
                </td>
                <td *ngIf="item.upcoming_tasks"
                    [ngClass]="getGreenClass(i)">
                    <a href="{{this.getBasePath()}}/projects/{{item.upcoming_tasks.projectId}}"
                    [textContent]="shorten(item.upcoming_tasks.project)"  [title]="item.upcoming_tasks.project"></a>
                </td>
                <td *ngIf="!item.upcoming_tasks" [ngClass]="getGreenClass(i)"></td>
                <td *ngIf="!item.upcoming_tasks" [ngClass]="getGreenClass(i)"></td>
                <td *ngIf="!item.upcoming_tasks" [ngClass]="getGreenClass(i)"></td>

                <td *ngIf="item.due_milestone"
                    [ngClass]="getRedClass(i)"
                    [textContent]="i + 1"></td>
                <td *ngIf="item.due_milestone"
                    [ngClass]="getRedClass(i)">
                    <a href="{{this.getBasePath()}}/projects/{{item.due_milestone.projectId}}/work_packages/{{item.due_milestone.id}}/activity?plan_type=execution"
                       [textContent]="shorten(item.due_milestone.subject)" [title]="item.due_milestone.subject"></a>
                </td>
                <td *ngIf="item.due_milestone"
                    [ngClass]="getRedClass(i)">
                    <a href="{{this.getBasePath()}}/projects/{{item.due_milestone.projectId}}"
                       [textContent]="shorten(item.due_milestone.project)" [title]="item.due_milestone.project"></a>
                </td>
                <td *ngIf="!item.due_milestone" [ngClass]="getRedClass(i)"></td>
                <td *ngIf="!item.due_milestone" [ngClass]="getRedClass(i)"></td>
                <td *ngIf="!item.due_milestone" [ngClass]="getRedClass(i)"></td>

                <td *ngIf="item.problems"
                    [ngClass]="getOrangeClass(i)"
                    [textContent]="i + 1"></td>
                <td *ngIf="item.problems"
                    [ngClass]="getOrangeClass(i)">
                    <a href="{{this.getBasePath()}}/work_packages/{{item.problems.wpid}}/problems"
                       [textContent]="shorten(item.problems.risk)" [title]="item.problems.risk"></a>
                </td>
                <td *ngIf="item.problems"
                    [ngClass]="getOrangeClass(i)">
                    <a href="{{this.getBasePath()}}/work_packages/{{item.problems.wpid}}"
                       [textContent]="shorten(item.problems.wptitle)" [title]="item.problems.wptitle"></a>
                </td>
                <td *ngIf="!item.problems" [ngClass]="getOrangeClass(i)"></td>
                <td *ngIf="!item.problems" [ngClass]="getOrangeClass(i)"></td>
                <td *ngIf="!item.problems" [ngClass]="getOrangeClass(i)"></td>

                <td *ngIf="item.budget"
                    [ngClass]="getPurpleClass(i)"
                    [textContent]="i + 1"></td>
                <td *ngIf="item.budget"
                    [ngClass]="getPurpleClass(i)">
                    <a href="{{this.getBasePath()}}/projects/{{item.budget.id}}"
                       [textContent]="shorten(item.budget.name)" [title]="item.budget.name"></a>
                </td>
                <td *ngIf="item.budget"
                    [ngClass]="getPurpleClass(i)"[textContent]="item.budget.value.toFixed(2)">
                </td>
                <td *ngIf="!item.budget" [ngClass]="getPurpleClass(i)"></td>
                <td *ngIf="!item.budget" [ngClass]="getPurpleClass(i)"></td>
                <td *ngIf="!item.budget" [ngClass]="getPurpleClass(i)"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
